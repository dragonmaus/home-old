#!/command/execlineb -S0
pipeline
{
  grep --colour=always --line-buffered --null $@
}
pipeline
{
  tr \\0\\t \\t\\0
}
pipeline
{
  multisubstitute
  {
    define CE "\033[K"
    importas -D 35 HC GREP_COLOUR_HEADER
    importas -D 36 SC GREP_COLOUR_SEP
  }
  multisubstitute
  {
    define H "\033[${HC}m${CE}"
    define S "\033[${SC}m${CE}"
    define R "\033[m${CE}"
  }
  sed -E "s/^([^\t]*)\t/${H}\\1${R}${S}:${R}/"
}
tr \\t\\0 \\0\\t
